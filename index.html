<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ãŸã¹ãã‚ƒã‚‰ | Vanilla HTML/CSS/JS</title>
  <style>
    :root {
      --bg: #0b0f14;          /* èƒŒæ™¯(å¤–å´) */
      --screen: #f6f7fb;      /* ç”»é¢(å†…å´) */
      --text: #10131a;
      --muted: #677085;
      --primary: #4f46e5;     /* Indigo */
      --accent: #10b981;      /* Emerald */
      --danger: #ef4444;      /* Red */
      --border: #e6e8f0;
      --shadow: 0 20px 80px rgba(0,0,0,.25);
      --radius: 22px;
    }
    html, body { height: 100%; }
    body {
      margin: 0; display: grid; place-items: center; background: radial-gradient(1200px 700px at 50% -10%, #151a22, var(--bg)); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: var(--text);
    }
    /* iPhoneãƒ•ãƒ¬ãƒ¼ãƒ é¢¨ */
    .phone {
      position: relative; width: 390px; height: 844px; border-radius: calc(var(--radius) + 10px); padding: 12px; background: linear-gradient(145deg, #2c3442, #0f1319); box-shadow: var(--shadow), inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .screen {
      position: relative; width: 100%; height: 100%; border-radius: var(--radius); background: var(--screen); overflow: hidden; box-shadow: inset 0 0 0 1px var(--border);
      display: grid; grid-template-rows: auto 1fr auto; /* topbar, content, tabbar */
    }
    /* Dynamic Island/ãƒãƒƒãƒé¢¨ */
    .island { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); width: 120px; height: 35px; background: #0c0f14; border-radius: 18px; box-shadow: 0 6px 12px rgba(0,0,0,.25); z-index: 2; }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header {
      display: flex; align-items: center; justify-content: space-between; padding: 54px 16px 12px; position: relative; background: linear-gradient(#ffffff, #fafbff);
      border-bottom: 1px solid var(--border);
    }
    header h1 { font-size: 18px; margin: 0; font-weight: 700; }
    .hdr-btn { border: 1px solid var(--border); background: #fff; padding: 6px 10px; border-radius: 12px; font-size: 12px; color: var(--muted); cursor: pointer; }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸ */
    #app { padding: 16px; overflow: auto; }
    .card { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 14px; box-shadow: 0 2px 8px rgba(16,19,26,.03); }
    .title { font-size: 20px; margin: 4px 0 12px; }
    .muted { color: var(--muted); }

    /* ãƒ•ã‚©ãƒ¼ãƒ  */
    .field { display: grid; gap: 6px; margin-bottom: 12px; }
    label { font-size: 12px; color: var(--muted); }
    input, select { border: 1px solid var(--border); border-radius: 12px; padding: 10px 12px; font-size: 14px; background: #fff; }
    .btn { display: inline-block; padding: 10px 14px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-outline { background: #fff; border: 1px solid var(--border); color: var(--text); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-block { width: 100%; text-align: center; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    /* ã‚¿ãƒ–ãƒãƒ¼ï¼ˆä¸‹ã®5ã¤ã®ãƒœã‚¿ãƒ³ï¼‰ */
    nav.tabbar { display: grid; grid-template-columns: repeat(5, 1fr); border-top: 1px solid var(--border); background: #fff; }
    .tab { padding: 8px 0 10px; display: grid; gap: 4px; place-items: center; font-size: 10px; color: var(--muted); cursor: pointer; }
    .tab.active { color: var(--primary); font-weight: 700; }

    /* å°ã•ãªã‚¢ã‚¤ã‚³ãƒ³é¢¨ï¼ˆCSSã ã‘ã§ï¼‰ */
    .ico { width: 22px; height: 22px; border-radius: 6px; border: 2px solid currentColor; }
    .ico.home { border-radius: 50%; }
    .ico.user { border-top-left-radius: 50%; }

    /* ã¡ã‚‡ã„ã‚¢ãƒ‹ãƒ¡ */
    .fade { animation: fade .2s ease; }
    @keyframes fade { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: none; } }

    /* ã‚¹ãƒãƒ›å®Ÿæ©Ÿå¯„ã›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ */
    @media (max-width: 480px) {
      body { place-items: start; }
      .phone { width: 100vw; height: 100vh; border-radius: 0; padding: 0; background: var(--screen); box-shadow: none; }
      .screen { border-radius: 0; box-shadow: none; }
      .island { top: env(safe-area-inset-top, 8px); }
      header { padding-top: calc(36px + env(safe-area-inset-top, 0px)); }
    }
  </style>
</head>
<body>
  <div class="phone">
    <div class="screen">
      <div class="island" aria-hidden="true"></div>
      <header>
        <button class="hdr-btn" id="backBtn">æˆ»ã‚‹</button>
        <h1 id="title">ãŸã¹ãã‚ƒã‚‰</h1>
        <button class="hdr-btn" id="helpBtn">ãƒ˜ãƒ«ãƒ—</button>
      </header>
      <main id="app" class="fade"></main>
      <nav class="tabbar">
        <div class="tab" data-tab="mypage"><div class="ico user"></div><span>My</span></div>
        <div class="tab" data-tab="accessory"><div class="ico"></div><span>ç€æ›¿ãˆ</span></div>
        <div class="tab active" data-tab="home"><div class="ico home"></div><span>Home</span></div>
        <div class="tab" data-tab="friends"><div class="ico"></div><span>å‹ã ã¡</span></div>
        <div class="tab" data-tab="settings"><div class="ico"></div><span>è¨­å®š</span></div>
      </nav>
    </div>
  </div>

  <script>
    // --- ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹ç®¡ç†ï¼ˆlocalStorageã«ä¿å­˜ï¼‰ ---
    const State = {
      get() { return JSON.parse(localStorage.getItem('tabekyara') || '{}'); },
      set(patch) { const next = { ...State.get(), ...patch }; localStorage.setItem('tabekyara', JSON.stringify(next)); return next; },
      clear() { localStorage.removeItem('tabekyara'); }
    };

    // --- ãƒ«ãƒ¼ã‚¿ãƒ¼ï¼ˆ# ã§ãƒšãƒ¼ã‚¸åˆ†å²ï¼‰ ---
    const routes = {
      '': 'start',
      'start': 'start',
      'login': 'login',
      'register': 'register',
      'onboarding': 'onboarding',
      'onboarding/pet-select': 'petSelect',
      'onboarding/pet-name': 'petName',
      'onboarding/goal': 'goal',
      'main': 'main',
    };

    const app = document.getElementById('app');
    const titleEl = document.getElementById('title');
    const backBtn = document.getElementById('backBtn');

    function navigate(path) { location.hash = '#' + path; }

    function parseHash() {
      const raw = location.hash.replace(/^#/, '');
      return raw || '';
    }

    function render() {
      app.classList.remove('fade'); void app.offsetWidth; app.classList.add('fade');
      const path = parseHash();
      const key = routes[path] || routes[path.split('?')[0]] || 'start';
      const page = Pages[key] || Pages.start;
      const title = Titles[key] || 'ãŸã¹ãã‚ƒã‚‰';
      titleEl.textContent = title;
      app.innerHTML = page();
      attachEvents[key]?.();
      highlightTab(key);
      updateBackButton();
    }

    function updateBackButton() {
      backBtn.onclick = () => history.back();
    }

    function highlightTab(key) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      const map = { main: 'home', start: 'home', login: 'home', register: 'home', onboarding: 'home', petSelect: 'home', petName: 'home', goal: 'home', mypage: 'mypage', accessory: 'accessory', friends: 'friends', settings: 'settings' };
      const current = map[key] || 'home';
      const tab = document.querySelector(`.tab[data-tab="${current}"]`);
      if (tab) tab.classList.add('active');
    }

    // ã‚¿ãƒ–ãƒãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const name = tab.getAttribute('data-tab');
        if (name === 'home') navigate('main');
        else if (name === 'mypage') alert('Myãƒšãƒ¼ã‚¸ã¯MVPå¾Œã§OKï¼');
        else if (name === 'accessory') alert('ç€æ›¿ãˆã¯å¾Œã§å®Ÿè£…äºˆå®šğŸ‘—');
        else if (name === 'friends') alert('å‹ã ã¡æ©Ÿèƒ½ã¯MVPå¾ŒğŸ«¶');
        else if (name === 'settings') navigate('start');
      });
    });

    // --- ãƒšãƒ¼ã‚¸ç¾¤ ---
    const Titles = {
      start: 'ã¯ã˜ã‚ã‚‹', login: 'ãƒ­ã‚°ã‚¤ãƒ³', register: 'æ–°è¦ç™»éŒ²', onboarding: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±', petSelect: 'ãƒšãƒƒãƒˆé¸æŠ', petName: 'ãƒšãƒƒãƒˆå', goal: 'ç›®æ¨™è¨­å®š', main: 'ãƒ›ãƒ¼ãƒ '
    };

    const Pages = {
      start() {
        return `
          <div class="card">
            <div class="title">ãŸã¹ãã‚ƒã‚‰ã¸ã‚ˆã†ã“ã</div>
            <p class="muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã€é£Ÿã¹ãŸãƒ¬ã‚·ãƒ”ã‚’ã‚­ãƒ£ãƒ©ã«é£Ÿã¹ã•ã›ã‚ˆã†ï¼</p>
            <div class="row" style="margin-top:12px;">
              <button class="btn btn-outline" id="goLogin">ãƒ­ã‚°ã‚¤ãƒ³</button>
              <button class="btn btn-primary" id="goRegister">æ–°è¦ç™»éŒ²</button>
            </div>
          </div>`;
      },
      login() {
        return `
          <form class="card" id="loginForm">
            <div class="title">ãƒ­ã‚°ã‚¤ãƒ³</div>
            <div class="field"><label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input name="email" type="email" required /></div>
            <div class="field"><label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><input name="password" type="password" required /></div>
            <button class="btn btn-primary btn-block" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
          </form>`;
      },
      register() {
        return `
          <form class="card" id="registerForm">
            <div class="title">æ–°è¦ç™»éŒ²</div>
            <div class="field"><label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input name="email" type="email" required /></div>
            <div class="field"><label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><input name="password" type="password" minlength="6" required /></div>
            <button class="btn btn-primary btn-block" type="submit">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
          </form>`;
      },
      onboarding() {
        const s = State.get();
        return `
          <form class="card" id="userForm">
            <div class="title">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</div>
            <div class="field"><label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label><input name="username" value="${s.username||''}" required /></div>
            <div class="field"><label>èª•ç”Ÿæ—¥</label><input name="birthday" type="date" value="${s.birthday||''}" required /></div>
            <div class="field"><label>ç§˜å¯†ã®è³ªå•ï¼ˆè¦šãˆã‚„ã™ã„ã‚‚ã®ï¼‰</label><input name="secret" value="${s.secret||''}" /></div>
            <button class="btn btn-primary btn-block" type="submit">ã¤ãã¸</button>
          </form>`;
      },
      petSelect() {
        const s = State.get();
        return `
          <form class="card" id="petForm">
            <div class="title">ãƒšãƒƒãƒˆã‚’é¸ã¶</div>
            <div class="field">
              <label>ç¨®é¡</label>
              <select name="petType" required>
                <option value="" ${!s.petType?'selected':''}>é¸æŠã—ã¦ãã ã•ã„</option>
                <option ${s.petType==='cat'?'selected':''} value="cat">ã­ã“</option>
                <option ${s.petType==='dog'?'selected':''} value="dog">ã„ã¬</option>
                <option ${s.petType==='slime'?'selected':''} value="slime">ã‚¹ãƒ©ã‚¤ãƒ </option>
              </select>
            </div>
            <button class="btn btn-primary btn-block" type="submit">ã¤ãã¸</button>
          </form>`;
      },
      petName() {
        const s = State.get();
        return `
          <form class="card" id="petNameForm">
            <div class="title">ãƒšãƒƒãƒˆã«åå‰</div>
            <div class="field"><label>ãªã¾ãˆ</label><input name="petName" value="${s.petName||''}" required /></div>
            <button class="btn btn-primary btn-block" type="submit">ã¤ãã¸</button>
          </form>`;
      },
      goal() {
        const s = State.get();
        return `
          <form class="card" id="goalForm">
            <div class="title">ç›®æ¨™ã‚’æ±ºã‚ã‚‹</div>
            <div class="field"><label>é£Ÿç”Ÿæ´»ã®ç›®æ¨™</label><input name="dietGoal" placeholder="ä¾‹: 1æ—¥2é£Ÿã¯é‡èœã‚’é£Ÿã¹ã‚‹" value="${s.dietGoal||''}" /></div>
            <div class="field"><label>è¨˜éŒ²ã®ç›®æ¨™</label><input name="logGoal" placeholder="ä¾‹: æ¯æ—¥1å›ã¯è¨˜éŒ²" value="${s.logGoal||''}" /></div>
            <button class="btn btn-primary btn-block" type="submit">ã¯ã˜ã‚ã‚‹</button>
          </form>`;
      },
      main() {
        const s = State.get();
        const greet = s.username ? `${s.username}ã•ã‚“` : 'ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã•ã‚“';
        const pet = s.petType ? `${s.petType}ã®` : '';
        const pname = s.petName || 'ãƒšãƒƒãƒˆ';
        return `
          <div class="card">
            <div class="title">${greet}ã€ã“ã‚“ã«ã¡ã¯ï¼</div>
            <p class="muted">${pet}${pname}ã¯ãŠè…¹ãºã“ãºã“â€¦ğŸ½ï¸ ãã‚‡ã†é£Ÿã¹ãŸã‚‚ã®ã‚’è¨˜éŒ²ã—ã¦é£Ÿã¹ã•ã›ã‚ˆã†ï¼</p>
            <div class="field"><label>é£Ÿã¹ãŸã‚‚ã®</label><input id="mealInput" placeholder="ä¾‹: ã‚µãƒ©ãƒ€ã€å‘³å™Œæ±ã€é®­" /></div>
            <div class="row">
              <button class="btn btn-outline" id="saveMeal">è¨˜éŒ²ã™ã‚‹</button>
              <button class="btn btn-primary" id="feedPet">ãƒšãƒƒãƒˆã«é£Ÿã¹ã•ã›ã‚‹</button>
            </div>
            <div style="margin-top:12px;">
              <button class="btn btn-danger btn-block" id="resetAll">ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
            </div>
          </div>
        `;
      }
    };

    // --- å„ãƒšãƒ¼ã‚¸ã®ã‚¤ãƒ™ãƒ³ãƒˆ ---
    const attachEvents = {
      start() {
        document.getElementById('goLogin').onclick = () => navigate('login');
        document.getElementById('goRegister').onclick = () => navigate('register');
      },
      login() {
        document.getElementById('loginForm').onsubmit = (e) => {
          e.preventDefault();
          // ãƒ‡ãƒ¢: ãã®ã¾ã¾ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã«ã™ã‚‹
          navigate('main');
        }
      },
      register() {
        document.getElementById('registerForm').onsubmit = (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          State.set({ email: fd.get('email') });
          navigate('onboarding');
        }
      },
      onboarding() {
        document.getElementById('userForm').onsubmit = (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          State.set({ username: fd.get('username'), birthday: fd.get('birthday'), secret: fd.get('secret') });
          navigate('onboarding/pet-select');
        }
      },
      petSelect() {
        document.getElementById('petForm').onsubmit = (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          State.set({ petType: fd.get('petType') });
          navigate('onboarding/pet-name');
        }
      },
      petName() {
        document.getElementById('petNameForm').onsubmit = (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          State.set({ petName: fd.get('petName') });
          navigate('onboarding/goal');
        }
      },
      goal() {
        document.getElementById('goalForm').onsubmit = (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          State.set({ dietGoal: fd.get('dietGoal'), logGoal: fd.get('logGoal') });
          navigate('main');
        }
      },
      main() {
        document.getElementById('saveMeal').onclick = () => {
          const v = document.getElementById('mealInput').value.trim();
          if (!v) return alert('é£Ÿã¹ãŸã‚‚ã®ã‚’å…¥åŠ›ã—ã¦ã­');
          const s = State.get();
          const meals = s.meals || [];
          meals.push({ at: Date.now(), text: v });
          State.set({ meals });
          alert('è¨˜éŒ²ã—ãŸã‚ˆï¼');
        };
        document.getElementById('feedPet').onclick = () => {
          const s = State.get();
          if (!s.meals || s.meals.length === 0) return alert('ã¾ãšã¯é£Ÿã¹ãŸã‚‚ã®ã‚’è¨˜éŒ²ã—ã‚ˆã†ï¼');
          alert('ã‚‚ãã‚‚ãâ€¦ã‚­ãƒ£ãƒ©ãŒå°‘ã—æˆé•·ã—ãŸï¼(æ¼”å‡ºã¯ã‚ã¨ã§å®Ÿè£…)');
        };
        document.getElementById('resetAll').onclick = () => {
          if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) { State.clear(); navigate('start'); }
        };
      }
    };

    // --- ãƒ˜ãƒ«ãƒ— ---
    document.getElementById('helpBtn').onclick = () => {
      alert('MVPãƒ‡ãƒ¢: ãƒ­ã‚°ã‚¤ãƒ³â†’æ–°è¦ç™»éŒ²â†’ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°â†’ãƒ›ãƒ¼ãƒ ã¾ã§è©¦ã›ã¾ã™ã€‚');
    };

    window.addEventListener('hashchange', render);
    render(); // åˆå›

    // Deep linkå¯¾å¿œï¼ˆç›´æ¥ /onboarding/... ãªã©ã«æ¥ãŸã¨ãï¼‰
    if (!location.hash) navigate('start');
  </script>
</body>
</html>
